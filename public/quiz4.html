<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Listening Sections</title>
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 850px;
        margin: 40px auto;
        padding: 0 20px;
    }

    h2 {
        margin-bottom: 10px;
    }

    h3 {
        margin-top: 40px;
    }

    .main-audio {
        margin-bottom: 20px;
        padding: 16px;
        border: 1px solid #ccc;
        border-radius: 6px;
        background: #f9f9f9;
    }

    .accordion {
        border: 1px solid #ccc;
        border-radius: 6px;
        margin-bottom: 12px;
        overflow: hidden;
    }

    .accordion-header {
        background: #f4f4f4;
        padding: 14px;
        cursor: pointer;
        font-weight: bold;
        border: none;
        width: 100%;
        text-align: left;
    }

    .accordion-content {
        display: none;
        padding: 16px;
        border-top: 1px solid #ccc;
        background: #fff;
    }

.choice {
    display: block;
    margin: 8px 0;
    cursor: pointer;
}


    .correct {
        color: green;
        font-weight: bold;
    }

    .reveal-btn {
        margin-top: 12px;
        padding: 6px 12px;
        cursor: pointer;
    }

    audio {
        width: 100%;
        margin-top: 10px;
    }
</style>
</head>
<body>

<h2>Listening Comprehension</h2>

<div id="app"></div>

<script>
const parts = [
  {
    "title": "Part 1 – Conversation",
    "mainAudio": "Test_1_011.mp3",
    "questions": [
      {
        "prompt": "Why does the student go to see the professor?",
        "choices": [
          "To prepare for her graduate school interview",
          "To get advice about her graduate school application",
          "To give the professor her graduate school application",
          "To find out if she was accepted into graduate school"
        ],
        "correctAnswer": 1,
        "audio": null
      },
      {
        "prompt": "According to the professor, what information should the student include in her statement of purpose? (Choose 2 answers.)",
        "choices": [
          "Her academic motivation",
          "Her background in medicine",
          "Some personal information",
          "The ways her teachers have influenced her"
        ],
        "correctAnswer": [0,2],
        "multiSelect": true,
        "audio": null
      },
      {
        "prompt": "What does the professor consider unusual about the student’s background?",
        "choices": [
          "Her work experience",
          "Her creative writing experience",
          "Her athletic achievements",
          "Her music training"
        ],
        "correctAnswer": 3,
        "audio": null
      },
      {
        "prompt": "Why does the professor tell a story about his friend who went to medical school?",
        "choices": [
          "To warn the student about how difficult graduate school can be",
          "To illustrate a point he is making",
          "To help the student relax",
          "To change the subject"
        ],
        "correctAnswer": 1,
        "audio": null
      },
      {
        "prompt": "What does the professor imply about the people who admit students to graduate school?",
        "choices": [
          "They often lack expertise in the fields of the applicants.",
          "They do not usually read the statement of purpose.",
          "They are influenced by the appearance of an application.",
          "They remember most of the applications they receive."
        ],
        "correctAnswer": 2,
        "audio": null
      }
    ]
  },
  {
    "title": "Part 2 – Lecture",
    "mainAudio": "Test_1_012.mp3",
    "questions": [
      {
        "prompt": "What is the talk mainly about?",
        "choices": [
          "A common method of managing water supplies",
          "The formation of underground water systems",
          "Natural processes that renew water supplies",
          "Maintaining the purity of underground water systems"
        ],
        "correctAnswer": 0,
        "audio": null
      },
      {
        "prompt": "What is the professor’s point of view concerning the method of “safe yield”?",
        "choices": [
          "It has helped to preserve the environment.",
          "It should be researched in states other than Arizona.",
          "It is not an effective resource policy.",
          "It ignores the different ways people use water."
        ],
        "correctAnswer": 2,
        "audio": null
      },
      {
        "prompt": "According to the professor, what are two problems associated with removing water from an underground system? (Choose 2 answers.)",
        "choices": [
          "Pollutants can enter the water more quickly.",
          "The surface area can dry and crack.",
          "The amount of water stored in the system can drop.",
          "Dependent streams and springs can dry up."
        ],
        "correctAnswer": [2,3],
        "multiSelect": true,
        "audio": null
      },
      {
        "prompt": "What is a key feature of a sustainable water system?",
        "choices": [
          "It is able to satisfy short-term and long-term needs.",
          "It is not affected by changing environmental conditions.",
          "It usually originates in lakes, springs, or streams.",
          "It is not used to supply human needs."
        ],
        "correctAnswer": 0,
        "audio": null
      },
      {
        "prompt": "What does the professor imply about water systems managed by the “safe-yield” method?",
        "choices": [
          "They recharge at a rapid rate.",
          "They are not sustainable.",
          "They must have large storage areas.",
          "They provide a poor quality of water."
        ],
        "correctAnswer": 1,
        "audio": null
      },
      {
        "prompt": "Why does the professor say this?",
        "choices": [
          "To find out whether the students are familiar with the issue",
          "To introduce a new problem for discussion",
          "To respond to a student’s question",
          "To encourage the students to care about the topic"
        ],
        "correctAnswer": 3,
        "audio": "Test_1_013.mp3"
      }
    ]
  }
];
const app = document.getElementById("app");

let allQuestions = []; // flat list for scoring

parts.forEach((part, partIndex) => {
    const section = document.createElement("section");

    section.innerHTML = `
        <h3>${part.title}</h3>
        <div class="main-audio">
            <strong>Listen to the audio:</strong>
            <audio controls src="${part.mainAudio}"></audio>
        </div>
    `;

    part.questions.forEach((q, qIndex) => {
        const acc = document.createElement("div");
        acc.className = "accordion";

        const header = document.createElement("button");
        header.className = "accordion-header";
        header.textContent = `Question ${qIndex + 1}`;

        const content = document.createElement("div");
        content.className = "accordion-content";

        content.innerHTML = `<p><strong>${q.prompt}</strong></p>`;

        if (q.audio) {
            const audio = document.createElement("audio");
            audio.controls = true;
            audio.src = q.audio;
            content.appendChild(audio);
        }

        const inputs = [];
        const isMulti = q.multiSelect === true;

        q.choices.forEach((choice, idx) => {
            const label = document.createElement("label");
            label.className = "choice";

            const input = document.createElement("input");
            input.type = isMulti ? "checkbox" : "radio";
            input.name = `q-${partIndex}-${qIndex}`;
            input.value = idx;

            label.appendChild(input);
            label.append(` ${String.fromCharCode(65 + idx)}. ${choice}`);

            content.appendChild(label);
            inputs.push({ input, label });
        });

        allQuestions.push({
            inputs,
            correct: q.correctAnswer,
            multi: isMulti,
            content
        });

        header.onclick = () => {
            section.querySelectorAll(".accordion-content").forEach(c => {
                if (c !== content) c.style.display = "none";
            });
            content.style.display = content.style.display === "block" ? "none" : "block";
        };

        acc.appendChild(header);
        acc.appendChild(content);
        section.appendChild(acc);
    });

    app.appendChild(section);
});

// SCORE BUTTON
const scoreWrapper = document.createElement("div");
scoreWrapper.style.marginTop = "30px";
scoreWrapper.style.display = "flex";
scoreWrapper.style.alignItems = "center";
scoreWrapper.style.gap = "12px";

const scoreBtn = document.createElement("button");
scoreBtn.textContent = "Show My Score";
scoreBtn.style.marginTop = "30px";
scoreBtn.style.padding = "10px 16px";
scoreBtn.style.fontSize = "16px";

const scoreText = document.createElement("span");
scoreText.style.fontWeight = "bold";


scoreBtn.onclick = () => {
    let score = 0;

    allQuestions.forEach(q => {
        const selected = q.inputs
            .filter(i => i.input.checked)
            .map(i => Number(i.input.value));

        const correct = Array.isArray(q.correct) ? q.correct : [q.correct];

        const isCorrect =
            selected.length === correct.length &&
            selected.every(v => correct.includes(v));

        if (isCorrect) score++;

        // show feedback
        q.inputs.forEach(({ input, label }) => {
            const idx = Number(input.value);

            if (correct.includes(idx)) {
                label.style.color = "green";
                label.style.fontWeight = "bold";
            } else if (input.checked) {
                label.style.color = "red";
            }

            input.disabled = true;
        });

        q.content.style.display = "block";
    });

    scoreText.textContent = `Score: ${score} / ${allQuestions.length}`;
    scoreBtn.disabled = true;
};

scoreWrapper.appendChild(scoreBtn);
scoreWrapper.appendChild(scoreText);
app.appendChild(scoreWrapper);
</script>

</body>
</html>
